<!DOCTYPE html><html class="no-js" lang="en"><head>
<meta charset="utf-8">
<meta content="width=device-width,initial-scale=1" name="viewport">
<meta content="Describes how to prepare data using the GitHub repo. This is also called &quot;ETL&quot;." etl"."="" name="description">
<meta content="Just van den Broecke" name="author">
<link href="https://map5topo.nl/create/data/" rel="canonical">
<link href="../setup/" rel="prev">
<link href="../map/" rel="next">
<link href="../../assets/favicon.ico" rel="icon">
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.20" name="generator">
<title>Data Preparation - map5topo.nl</title>
<link href="../../assets/stylesheets/main.e53b48f4.min.css" rel="stylesheet">
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet">
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect">
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet">
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../assets/stylesheets/termynal.css" rel="stylesheet">
<link href="../../assets/stylesheets/custom.css" rel="stylesheet">
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<meta content="Data" name="title"><meta content="website" property="og:type"><meta content="https://map5topo.nl/create/data" property="og:url"><meta content="Data" property="og:title"><meta content="Describes how to prepare data using the GitHub repo. This is also called &quot;ETL&quot;." property="og:description"><meta content="https://map5topo.nl/assets/images/map5-logo.png" property="og:image"><meta content="summary_large_image" property="twitter:card"><meta content="https://map5topo.nl/create/data" property="twitter:url"><meta content="Data" property="twitter:title"><meta content="Describes how to prepare data using the GitHub repo. This is also called &quot;ETL&quot;." property="twitter:description"><meta content="https://map5topo.nl/assets/images/map5-logo.png" property="twitter:image"><style>
.md-content__button[onclick*="copyMarkdownForLLM"] svg {
    width: 1.2rem;
    height: 1.2rem;
    fill: currentColor;
}

.git-info, .dates-container, .authors-container, .share-buttons {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    flex-wrap: wrap;
}

.git-info {
    font-size: 0.8em;
    color: grey;
    margin-bottom: 10px;
}

.dates-container, .authors-container {
    margin-bottom: 10px;
}

.date-item, .author-link, .share-button {
    display: flex;
    align-items: center;
    cursor: pointer;
}

.date-item {
    margin-right: 10px;
}

.hover-item {
    transition: all 0.2s ease;
    filter: grayscale(100%);
}

.date-item .hover-item {
    font-size: 1.6em;
    margin-right: 5px;
}

.author-link .hover-item {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    margin-right: 3px;
    background-color: #f0f0f0;  /* Placeholder color */
    opacity: 0;  /* Start fully transparent */
    transition: opacity 0.3s ease-in-out;
}

.author-link .hover-item[src] {
    opacity: 1;  /* Fade in when src is set (image loaded) */
}

.share-buttons {
    margin-top: 10px;
}

.share-button {
    background-color: #1da1f2;
    color: white;
    padding: 6px 12px;
    border-radius: 5px;
    border: none;
    font-size: 0.95em;
    margin: 5px;
    transition: all 0.2s ease;
}

.share-button.linkedin {
    background-color: #0077b5;
}

.share-button i {
    margin-right: 5px;
    font-size: 1.1em;
}

/* Hover effects */
.share-button:hover,
.hover-item:hover {
    color: var(--md-accent-fg-color);
    transform: scale(1.1);
    filter: brightness(1.2) grayscale(0%);
}

@media (max-width: 1024px) {
    .git-info {
        flex-direction: column;
        align-items: flex-end;
    }
    .dates-container, .authors-container {
        width: 100%;
    }
}
</style><link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="map5topo" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox">
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox">
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#data">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="map5topo.nl" class="md-header__button md-logo" data-md-component="logo" href="../.." title="map5topo.nl">
<img alt="logo" src="../../assets/images/map5-logo-bg-black.png">
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            map5topo.nl
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Data Preparation
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text">
<label class="md-search__icon md-icon" for="__search">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/map5nl/map5topo.nl" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="map5topo.nl" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="map5topo.nl">
<img alt="logo" src="../../assets/images/map5-logo-bg-black.png">
</a>
    map5topo.nl
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/map5nl/map5topo.nl" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox">
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
<span class="md-ellipsis">
    Design
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Design
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../design/spec/">
<span class="md-ellipsis">
    Specification
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../design/architecture/">
<span class="md-ellipsis">
    Architecture
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../design/data/">
<span class="md-ellipsis">
    Data
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../design/gitops/">
<span class="md-ellipsis">
    Deployment
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox">
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
<span class="md-ellipsis">
    Creation
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Creation
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../method/">
<span class="md-ellipsis">
    Method
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../setup/">
<span class="md-ellipsis">
    Setup
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox">
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Data
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Data
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-startup-once">
<span class="md-ellipsis">
      1. Startup (once)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-overall">
<span class="md-ellipsis">
      2. Overall
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-data-etl">
<span class="md-ellipsis">
      2. Data ETL
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-dem">
<span class="md-ellipsis">
      3. DEM
    </span>
</a>
<nav aria-label="3. DEM" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#download-ready-files">
<span class="md-ellipsis">
      Download Ready files
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#preparing-download-shrink-and-fill-holes">
<span class="md-ellipsis">
      Preparing: Download, shrink and fill holes
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#generate-hillshade">
<span class="md-ellipsis">
      Generate Hillshade
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#generate-contour-lines">
<span class="md-ellipsis">
      Generate Contour Lines
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-sea-and-water-shapes-sea-only">
<span class="md-ellipsis">
      4. Sea and Water Shapes (Sea Only)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../map/">
<span class="md-ellipsis">
    Map
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox">
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
<span class="md-ellipsis">
    Gallery
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Gallery
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../gallery/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../gallery/2022/">
<span class="md-ellipsis">
    2022
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../gallery/2023/">
<span class="md-ellipsis">
    2023
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../gallery/2024/">
<span class="md-ellipsis">
    2024
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../gallery/2025/">
<span class="md-ellipsis">
    2025
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../research/">
<span class="md-ellipsis">
    Research
    
  </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-startup-once">
<span class="md-ellipsis">
      1. Startup (once)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-overall">
<span class="md-ellipsis">
      2. Overall
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-data-etl">
<span class="md-ellipsis">
      2. Data ETL
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-dem">
<span class="md-ellipsis">
      3. DEM
    </span>
</a>
<nav aria-label="3. DEM" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#download-ready-files">
<span class="md-ellipsis">
      Download Ready files
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#preparing-download-shrink-and-fill-holes">
<span class="md-ellipsis">
      Preparing: Download, shrink and fill holes
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#generate-hillshade">
<span class="md-ellipsis">
      Generate Hillshade
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#generate-contour-lines">
<span class="md-ellipsis">
      Generate Contour Lines
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-sea-and-water-shapes-sea-only">
<span class="md-ellipsis">
      4. Sea and Water Shapes (Sea Only)
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<div><h1 id="data">Data</h1>
<p>Describes how to prepare data using the GitHub repo. This is also called "ETL".</p>
<h2 id="1-startup-once">1. Startup (once)</h2>
<ul>
<li><code>git clone https://github.com/map5nl/map5topo.git</code></li>
<li>edit <code>git/env.sh</code> for your local hostname such that the main dirs are set by adding your host to <code>case</code> switch</li>
<li>get credentials storage server, have your SSH public key (usually <code>id_rsa.pub</code>)  added for rsync without password</li>
</ul>
<p>Two global env vars are important, but have defaults:</p>
<ul>
<li><code>DEPLOY_SERVER</code>: set via hostname, usually <code>"local"</code>, only for production server it is <code>"prod"</code>. Has to do with SSL and domain settings mostly.</li>
<li><code>MAP_AREA</code>  defaults: <code>muiden</code> on local systems and <code>nl</code>  when <code>DEPLOY_SERVER=prod</code>.</li>
</ul>
<p>Possible values for MAP_AREA: <code>muiden, utrecht, nl</code>.
To override <code>MAP_AREA</code>, e.g. to create full NL on local system 
e.g.: <code>export MAP_AREA=nl</code> or <code>export MAP_AREA=utrecht</code>
in bash shell before calling any tools.</p>
<h2 id="2-overall">2. Overall</h2>
<p>Data steps:</p>
<ul>
<li>DEM: pre-processing AHN DTM and hillshading and contour lines</li>
<li>BGT download/import</li>
<li>BRT download/import</li>
<li>BRK (Parcels) download/import</li>
<li>NWB (Hectoborden and Kilometerpoints) download/import</li>
<li>OSM Data ETL: download PBF and convert to PostGIS</li>
<li>DEM: generate contour-lines and put in PostGIS as lines</li>
<li>Grid: download, import SQL of 1km RD-gridlines, "kilometerhokken" </li>
<li>tiles: seed</li>
<li>test: generate Mapnik tiles and web services</li>
</ul>
<p>All steps from git root dir. Many datasets have already been prepared
in particular DEM (AHN Hillshade and Contours) so these only need to be downloaded.</p>
<p><code>map5</code> is a special dataset: this is a DB schema generated locally from the above dataset. It creates
tables that mix records from loaded datasets. So it always needs to run as last.</p>
<h2 id="2-data-etl">2. Data ETL</h2>
<p>These are the minimum steps. Most datasets have smaller areas available: 'muiden' and (province) 'utrecht'</p>
<p>You may want to set MAP_AREA to test
'muiden' first: <code>export MAP_AREA=muiden</code> in the same terminal session as running the commands. </p>
<p><code>MAP_AREA</code> possible values <code>muiden</code>, <code>utrecht</code>, <code>nl</code> (whole country)</p>
<p>The database needs to run, as a minimum do: <code>cd services/postgis; ./start.sh</code>. This also starts
pgadmin4, a web-based DB manager. To access you need to start 'Traefik' service as well: <code>cd services/traefik; ./start.sh</code></p>
<p>Or run entire service stack, including MapProxy and apps: <code>cd services; ./start.sh</code></p>
<p>Now download and load all data.</p>
<p></p><div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>tools

<span class="c1"># all steps in one:  </span>
<span class="c1"># downloads all data and runs etl for DB, all for MAP_AREA</span>
./etl-all.sh
</code></pre></div></td></tr></tbody></table></div>
On 'local' installations, all downloaded data is under <code>git/data</code>.
This should be guarded to not push these to GitHub!
<p>You can also run individual steps for download and load:</p>
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Download multiple datasets</span>
./download.sh<span class="w"> </span>bgt<span class="w"> </span>brk<span class="w"> </span>brt<span class="w"> </span>osm<span class="w"> </span>dem<span class="w"> </span>nwb<span class="w"> </span>grid

<span class="c1"># or single dataset</span>
./download.sh<span class="w"> </span>brk

<span class="c1"># Load downloaded data into DB (BRT not yet)</span>
./etl-load.sh<span class="w"> </span>bgt
./etl-load.sh<span class="w"> </span>brk
./etl-load.sh<span class="w"> </span>brt
./etl-load.sh<span class="w"> </span>nwb
./etl-load.sh<span class="w"> </span>osm
./etl-load.sh<span class="w"> </span>dem-contours
./etl-load.sh<span class="w"> </span>grid
./etl-load.sh<span class="w"> </span>map5<span class="w"> </span>

<span class="c1"># or only OSM</span>
./etl-osm-all.sh
</code></pre></div></td></tr></tbody></table></div>
<p>If all goes well, you can test if you can generate tiles with Mapnik (more below):</p>
<p><code>./mapnik-render-cat.sh roads</code></p>
<p>To force full NL preparation locally, set <code>export MAP_AREA="nl"</code>.</p>
<h2 id="3-dem">3. DEM</h2>
<p>NB: this step is only required if you ever need to prepare DEM. Normally you download
the already prepared files for Hillshade and Contours via <code>tools/download.sh dem</code> (see above).</p>
<p>To prepare entire NL you will need storage for about 600GB. If you only download the already prepared
(dem/output) files, about 100GB is needed. All DEM processing is initiated from the <code>tools/dem</code> dir.</p>
<p>The processing is MAP_AREA-aware, so you can test for small areas.</p>
<h3 id="download-ready-files">Download Ready files</h3>
<p>Use this to download entire NL (hillshade and contours in 5m and 05m). No local preparation needed:</p>
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>tools/dem
./dem-download.sh<span class="w"> </span>output
</code></pre></div></td></tr></tbody></table></div>
<h3 id="preparing-download-shrink-and-fill-holes">Preparing: Download, shrink and fill holes</h3>
<p>Use this to prepare small area mainly. 
Using <code>tools/dem-prepare.sh &lt;muiden|utrecht|nl&gt; 5m [05m]</code>. </p>
<p>Full NL, all resolutions:</p>
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>tools
./dem-prepare.sh<span class="w"> </span>nl<span class="w"> </span>5m<span class="w"> </span>05m
</code></pre></div></td></tr></tbody></table></div>
<p>Takes about 40h. About 1370 DTM tiff files per resolution.
But cleaned and lossless compressed TIFF input files are produced. 
Only needed once. Hillshade and Contour generation are separate
steps using the result of this step.</p>
<p>Some warnings, possibly rounding issues (?).</p>
<div class="highlight"><pre><span></span><code>Warning 1: The definition of geographic CRS EPSG:4289 got from 
GeoTIFF keys is not the same as the one from the EPSG registry, 
which may cause issues during reprojection operations. Set GTIFF_SRS_SOURCE 
configuration option to EPSG to use official parameters (overriding the ones from GeoTIFF keys), 
or to GEOKEYS to use custom values from GeoTIFF keys and drop the EPSG code.
</code></pre></div>
<p>For local, small area (muiden or utrecht)</p>
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>tools/dem
./dem-prepare.sh<span class="w"> </span>muiden<span class="w"> </span>5m<span class="w"> </span>05m
</code></pre></div></td></tr></tbody></table></div>
<h3 id="generate-hillshade">Generate Hillshade</h3>
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>tools/dem
./dem-hillshade.sh<span class="w"> </span>5m<span class="w"> </span>05m
</code></pre></div></td></tr></tbody></table></div>
<p>Generates one GeoTIFF with b&amp;w hillshade per resolution.
Start za 11 juni, 2022, 19:45. Ready  june 12, 04:08. About 8.5 hrs. </p>
<p>Tip: You may run any command using the GDAL Docker Image. You need to be in the <code>docker</code> subdir.</p>
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>tools/dem/docker
<span class="sb">`</span>./run-docker.sh<span class="w"> </span><span class="s2">"gdalinfo /data/output/5m/hillshade-5m.tif"</span><span class="sb">`</span>
</code></pre></div></td></tr></tbody></table></div>
<h3 id="generate-contour-lines">Generate Contour Lines</h3>
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>tools
./dem-contours.sh
</code></pre></div></td></tr></tbody></table></div>
<h2 id="4-sea-and-water-shapes-sea-only">4. Sea and Water Shapes (Sea Only)</h2>
<p><strong>(NOT REQUIRED FOR LOCAL SYSTEM since data will be downloaded during OSM ETL)</strong></p>
<p>Need the generalized water polygons from osmdata.openstreetmap.de as SQL Dump files.
See <code>tools/etl/osm-prepare-sea.sh</code>.  Basically this sequence to prepare. Need GDAL <code>ogr2ogr</code>.</p>
<div class="highlight"><pre><span></span><code>/bin/rm -rf *-water-polygons-split-3857* *.sql.gz &gt; /dev/null 2&gt;&amp;1

export OGR_OPTS="--config PG_USE_COPY YES -lco GEOMETRY_NAME=geom -overwrite -a_srs EPSG:28992 -s_srs EPSG:3857 -t_srs EPSG:28992 -spat 296778 6514442 853487 7143686"

# 1. simplified-water-polygons
wget https://osmdata.openstreetmap.de/download/simplified-water-polygons-split-3857.zip
unzip simplified-water-polygons-split-3857.zip
export DUMP_FILE="sea-polygons-simplified-28992-nl.sql"
ogr2ogr -f PGDump ${DUMP_FILE} simplified-water-polygons-split-3857 ${OGR_OPTS}
gzip ${DUMP_FILE}

# 2. water-polygons
wget https://osmdata.openstreetmap.de/download/water-polygons-split-3857.zip
unzip water-polygons-split-3857.zip
export DUMP_FILE="sea-polygons-28992-nl.sql"
ogr2ogr -f PGDump ${DUMP_FILE} water-polygons-split-3857 ${OGR_OPTS}
gzip ${DUMP_FILE}

/bin/rm -rf *water-polygons-split-3857*
</code></pre></div>
<p>Uploaded to: https://data.nlextract.nl/osm/nl/. 
Will be imported into the <code>map5.water</code> table during <code>map5</code> ETL.</p></div>
<br><br>
<div class="git-info">
<div class="dates-container">
<span class="date-item" title="This page was first created on September 18, 2025">
<span class="hover-item">üìÖ</span> Created 0 days ago
    </span>
<span class="date-item" title="This page was last updated on September 18, 2025">
<span class="hover-item">‚úèÔ∏è</span> Updated 0 days ago
    </span>
</div>
<div class="authors-container">
<a class="author-link" href="https://github.com/justb4" title="justb4 (1 change)">
<img alt="justb4" class="hover-item" loading="lazy" src="https://avatars.githubusercontent.com/u/582630?v=4&amp;s=96">
</a>
</div></div></article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      ¬© 2023 Just Objects B.V.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
<script src="../../assets/javascripts/termynal.js"></script>
<script src="../../assets/javascripts/custom.js"></script>

<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>